# n8n Workflow Use Case: Automated Fireflies Transcript Processing

## Purpose
Automatically capture, process, and store STRMS demo call transcripts from Fireflies into the GrowthLab AI Console's Supabase database, creating structured project records with AI-extracted metadata and organized file storage.

## Business Context
When sales/customer success teams conduct STRMS product demos, Fireflies records and transcribes the meetings. This workflow eliminates manual data entry by automatically:
- Creating new project records in the STRMS pipeline
- Storing transcripts for future reference and analysis
- Extracting key business information using AI
- Organizing files in a structured storage system

---

## Workflow Trigger

**Type**: Webhook or Polling Trigger

**How it starts**:
- Fireflies generates a new transcript for a completed meeting
- The workflow monitors for new Fireflies transcripts (via API polling or webhook if available)
- Filter condition: Only process meetings where the title contains "STRMS Demo"

**Trigger Data Received**:
- Meeting title
- Meeting date/time
- Transcript ID or URL
- Full transcript text
- Participant information (if available)

---

## Step-by-Step Process

### Step 1: Fireflies Integration & Filtering
**What happens**:
1. Connect to Fireflies API (polling or webhook)
2. Retrieve new meeting transcripts
3. Filter for meetings containing "STRMS Demo" in the title
4. Extract the complete transcript text

**Data extracted**:
- Meeting title (e.g., "STRMS Demo - Acme Corp")
- Transcript full text
- Meeting date/timestamp
- Any participant metadata

**Output**: Raw transcript text and meeting metadata

---

### Step 2: AI Analysis & Project Creation
**What happens**:
1. Send transcript to OpenAI Chat Completion API using GPT-5-nano model
2. AI extracts structured data from the conversation:
   - **project_name** (REQUIRED): Generate a descriptive project name if not explicitly stated
   - **company** (OPTIONAL): Extract company name if mentioned
   - **contact_name** (OPTIONAL): Extract client contact name if mentioned
   - **email** (OPTIONAL): Extract email address if mentioned
3. Insert a new row into the `strms_projects` table

**Database Schema - strms_projects**:
| Column | Type | Required | Default | AI Extraction Notes |
|--------|------|----------|---------|---------------------|
| id | uuid | Auto-generated | gen_random_uuid() | System generated |
| project_name | text | YES | - | **MUST be extracted/generated by AI** |
| company | text | NO* | - | Extract if identifiable in transcript |
| contact_name | text | NO* | - | Extract if identifiable in transcript |
| email | text | NO* | - | Extract if identifiable in transcript |
| current_stage | text | Auto | 'demo' | Default is correct for new demos |
| last_activity | timestamptz | Auto | now() | System generated |
| created_at | timestamptz | Auto | now() | System generated |
| updated_at | timestamptz | Auto | now() | System generated |
| project_status | text | Auto | 'active' | Valid values: 'active', 'not-a-fit', 'proposal-declined', 'onboarding-complete' |

**Note**: While company, contact_name, and email show as NOT NULL in schema, they should be populated if identifiable. If not found in transcript, use placeholder values like "Unknown Company", "Unknown Contact", and "no-email@pending.com".

**OpenAI Chat Completion Prompt (GPT-5-nano)**:

System Message:
```
You are a data extraction assistant specializing in sales call analysis.
```

User Message:
```
Analyze this sales demo transcript and extract:
1. Project Name: Generate a descriptive name (e.g., "{Company} STRMS Implementation" or "STRMS Demo - {Date}" if company unclear)
2. Company Name: Extract if mentioned (otherwise return "Unknown Company")
3. Contact Name: Extract primary client contact if mentioned (otherwise return "Unknown Contact")
4. Email: Extract if mentioned (otherwise return "no-email@pending.com")

Return ONLY valid JSON with the extracted data.

Transcript:
{transcript_text}
```

**Insert Query Example**:
```sql
INSERT INTO strms_projects (project_name, company, contact_name, email, current_stage, project_status)
VALUES (
  '{ai_extracted_project_name}',
  '{ai_extracted_company}',
  '{ai_extracted_contact_name}',
  '{ai_extracted_email}',
  'demo',
  'active'
)
RETURNING id;
```

**Output**:
- New project UUID (from RETURNING id)
- Store this ID for use in subsequent steps

---

### Step 3: Transcript File Storage
**What happens**:
1. Convert the transcript text to a .txt file
2. Generate a filename using a logical naming convention
3. Upload the file to Supabase Storage bucket: `strms-project-files`
4. Capture the returned file path

**Filename Convention**:
```
{project_name}_demo_transcript_{timestamp}.txt
```
Example: `acme_corp_strms_demo_transcript_2025-01-15T14-30-00.txt`

**Sanitization Required**:
- Replace spaces with underscores
- Remove special characters except underscores and hyphens
- Convert to lowercase
- Ensure timestamp format is filesystem-safe (no colons)

**Storage Location**:
- Bucket: `strms-project-files`
- Path structure: `{project_id}/transcripts/{filename}.txt`
- Full path example: `a1b2c3d4-e5f6-7890-abcd-ef1234567890/transcripts/acme_corp_strms_demo_transcript_2025-01-15T14-30-00.txt`

**Supabase Storage Upload**:
- Use Supabase Storage API to upload file
- Set content type to `text/plain`
- Make file private (requires authentication to access)

**Output**:
- File path returned from storage upload
- File size in bytes

---

### Step 4: Update strms_project_files Table
**What happens**:
1. Insert a new record linking the uploaded file to the project
2. Use AI to generate a human-readable file name
3. Populate all required fields

**Database Schema - strms_project_files**:
| Column | Type | Required | Default | Notes |
|--------|------|----------|---------|-------|
| id | uuid | Auto-generated | gen_random_uuid() | System generated |
| project_id | uuid | YES | - | Use ID from Step 2 |
| file_type_id | text | YES | - | Set to "demo-call-transcript" |
| file_name | text | YES | - | **AI-generated human-readable name** |
| file_path | text | YES | - | Use exact path from Step 3 storage upload |
| file_size | bigint | YES | - | File size in bytes from Step 3 |
| uploaded_by | text | YES | - | Use "n8n-automation" or "fireflies-integration" |
| uploaded_at | timestamptz | Auto | now() | System generated |
| storage_bucket | text | Auto | 'strms-project-files' | Default is correct |
| storage_path | text | YES | - | Same as file_path (full path in bucket) |

**AI-Generated File Name Example (using GPT-5-nano)**:
```
Input: "STRMS Demo - Acme Corp - January 15, 2025"
GPT-5-nano Output: "Acme Corp STRMS Demo Call - Jan 15, 2025"
```

**Insert Query Example**:
```sql
INSERT INTO strms_project_files (
  project_id,
  file_type_id,
  file_name,
  file_path,
  file_size,
  uploaded_by,
  storage_bucket,
  storage_path
)
VALUES (
  '{project_id_from_step_2}',
  'demo-call-transcript',
  '{ai_generated_human_readable_name}',
  '{storage_path_from_step_3}',
  {file_size_in_bytes},
  'fireflies-integration',
  'strms-project-files',
  '{storage_path_from_step_3}'
);
```

**Output**: Confirmation of successful file record creation

---

## Services Connected

### 1. Fireflies.ai
- **Purpose**: Source of meeting transcripts
- **Connection Method**: REST API (polling) or Webhook (if supported)
- **Authentication**: API key
- **Data Retrieved**: Meeting metadata, transcript text, participant info

### 2. OpenAI Chat Completion (REQUIRED)
- **Purpose**: Extract structured data from unstructured transcript text
- **Connection Method**: REST API (Chat Completion endpoint)
- **Authentication**: API key
- **Model**: GPT-5-nano (required for this workflow)

### 3. Supabase Database (PostgreSQL)
- **Purpose**: Store project records and file metadata
- **Connection Method**: REST API or PostgreSQL direct connection
- **Authentication**: Service role key (for database writes)
- **Tables Modified**:
  - `strms_projects` (INSERT)
  - `strms_project_files` (INSERT)

### 4. Supabase Storage
- **Purpose**: Store transcript .txt files
- **Connection Method**: Supabase Storage REST API
- **Authentication**: Service role key
- **Bucket**: `strms-project-files`

---

## Expected Output

### Success Scenario:
1. **New Project Created**:
   - Project ID: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`
   - Project Name: "Acme Corp STRMS Implementation"
   - Company: "Acme Corp"
   - Contact: "John Smith"
   - Email: "john.smith@acmecorp.com"
   - Stage: "demo"
   - Status: "active"

2. **File Stored**:
   - File path: `a1b2c3d4-e5f6-7890-abcd-ef1234567890/transcripts/acme_corp_strms_demo_transcript_2025-01-15T14-30-00.txt`
   - File size: 45,320 bytes
   - Storage bucket: `strms-project-files`

3. **File Record Created**:
   - Linked to project ID above
   - File type: "demo-call-transcript"
   - Human-readable name: "Acme Corp STRMS Demo Call - Jan 15, 2025"
   - Uploaded by: "fireflies-integration"

4. **Notification** (Optional Enhancement):
   - Send Slack notification to sales team
   - Email notification to assigned account manager
   - Update dashboard/CRM

---

## What Could Go Wrong

### 1. Fireflies API Issues
**Problem**: API rate limiting, authentication failures, or service downtime
**Symptoms**:
- No transcripts retrieved
- 429 rate limit errors
- 401 authentication errors

**Mitigation**:
- Implement exponential backoff retry logic
- Cache API responses temporarily
- Set up error notifications to DevOps/admin
- Use webhook trigger instead of polling if available

---

### 2. AI Extraction Failures
**Problem**: AI fails to extract required fields or returns malformed data
**Symptoms**:
- Missing project_name (REQUIRED field)
- Incorrectly formatted data (e.g., email as "N/A" instead of valid email)
- AI returns error or times out

**Mitigation**:
- Implement fallback values:
  - project_name: Use "STRMS Demo - {meeting_date}" as fallback
  - company: Default to "Unknown Company"
  - contact_name: Default to "Unknown Contact"
  - email: Default to "no-email@pending.com"
- Add validation step to check AI response structure
- Implement retry with adjusted prompt if extraction fails
- Log AI responses for debugging

---

### 3. Database Insertion Errors
**Problem**: SQL errors, constraint violations, or connection issues
**Symptoms**:
- Foreign key violations
- NOT NULL constraint errors (if placeholders not used)
- Database connection timeout
- Duplicate entries

**Mitigation**:
- Validate all required fields before INSERT
- Use transactions to ensure atomicity (project + file records together)
- Check for existing projects with same name/company to avoid duplicates
- Implement database connection retry logic
- Log failed inserts with full error details

---

### 4. Storage Upload Failures
**Problem**: File upload to Supabase Storage fails
**Symptoms**:
- Network timeouts
- Storage bucket full or permission denied
- File path conflicts (file already exists)

**Mitigation**:
- Check storage bucket exists and has available space
- Verify service role has upload permissions
- Use unique filenames (include timestamp with milliseconds)
- Implement retry logic for transient network errors
- If upload fails, roll back database transaction
- Store transcript temporarily in workflow data for retry

---

### 5. File Path Mismatches
**Problem**: File path stored in database doesn't match actual storage location
**Symptoms**:
- Files uploaded but not accessible via recorded path
- 404 errors when trying to retrieve files from UI

**Mitigation**:
- Use the EXACT path returned by Supabase Storage upload API
- Don't construct paths manually - always use API response
- Validate file accessibility immediately after upload
- Store both `file_path` and `storage_path` with same value for redundancy

---

### 6. Meeting Title Filter Issues
**Problem**: Inconsistent meeting naming conventions
**Symptoms**:
- Demos missed because title doesn't contain exact string "STRMS Demo"
- Variations like "STRMS demo", "strms Demo", "STRMS Product Demo"

**Mitigation**:
- Use case-insensitive matching (e.g., `/strms.*demo/i`)
- Support multiple patterns: "STRMS Demo", "STRMS Product Demo", "STRMS Call"
- Allow configuration of filter patterns
- Log all skipped meetings for review
- Consider adding manual trigger override

---

### 7. Data Quality Issues
**Problem**: Transcript quality affects AI extraction accuracy
**Symptoms**:
- Short/incomplete transcripts
- Background noise or poor audio quality
- Multi-participant conversations without clear client info
- Technical jargon misinterpreted

**Mitigation**:
- Set minimum transcript length threshold (e.g., 500 words)
- Include transcript quality score check if available from Fireflies
- Use more sophisticated AI prompts with examples
- Implement manual review queue for low-confidence extractions
- Add "needs_review" flag to project record if confidence is low

---

### 8. Timing and Race Conditions
**Problem**: Workflow triggered before transcript fully processed by Fireflies
**Symptoms**:
- Incomplete transcripts
- Missing participant information
- Partial text causing AI extraction errors

**Mitigation**:
- Add delay/polling mechanism to wait for transcript completion
- Check Fireflies transcript status before processing
- Implement "ready" status check in trigger condition

---

### 9. File Type and Encoding Issues
**Problem**: Special characters or encoding issues in transcript text
**Symptoms**:
- Corrupted .txt files
- Special characters display incorrectly
- File won't open properly

**Mitigation**:
- Use UTF-8 encoding for all text files
- Sanitize special characters in filenames
- Test with sample transcripts containing edge cases
- Validate file contents after upload

---

## Error Handling Strategy

### Critical Errors (Stop Workflow):
- Fireflies API authentication failure
- Supabase database connection failure
- Missing required project_name from AI

### Recoverable Errors (Retry):
- Temporary API timeouts
- Rate limiting
- Network connection issues

### Warning Errors (Continue with Defaults):
- Missing optional fields (company, contact, email)
- Low confidence AI extractions
- File naming conflicts (append increment)

### Logging Requirements:
- Log all workflow executions (success/failure)
- Store failed workflow data for manual review
- Track AI extraction confidence scores
- Monitor processing time per transcript

---

## Future Enhancements (Out of Scope for v1)

1. **Sentiment Analysis**: Use AI to gauge client interest level from transcript
2. **Action Item Extraction**: Automatically create follow-up tasks from transcript
3. **Key Topic Identification**: Tag projects with mentioned features/requirements
4. **Multi-language Support**: Handle transcripts in different languages
5. **Speaker Diarization**: Track who said what in the conversation
6. **Integration with CRM**: Sync project data to Salesforce/HubSpot
7. **Automated Follow-up**: Generate and send follow-up emails based on transcript
8. **Meeting Summary**: Use AI to create executive summary of demo call

---

## Success Criteria

✅ **Workflow is successful when**:
1. Project created in `strms_projects` with valid project_name
2. Transcript file uploaded to `strms-project-files` bucket
3. File record created in `strms_project_files` with correct links
4. All required database fields populated (using defaults if needed)
5. File accessible via stored path
6. Entire process completes within 30 seconds
7. No data loss or corruption

---

## Testing Checklist

Before deploying to production:
- [ ] Test with transcript containing all optional fields (company, contact, email)
- [ ] Test with minimal transcript (only project_name extractable)
- [ ] Test with very long transcript (10,000+ words)
- [ ] Test with special characters in company/contact names
- [ ] Test with multiple meetings processed in quick succession
- [ ] Verify file paths work in GrowthLab AI Console UI
- [ ] Test failure scenarios (API down, database timeout, etc.)
- [ ] Validate AI extraction accuracy with 10+ real transcripts
- [ ] Ensure no duplicate project creation for same demo
- [ ] Confirm storage bucket permissions are correct
